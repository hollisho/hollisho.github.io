<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="卸载 是否保留数据 1 2 //告诉WCC，删除插件的时候，是否保留数据 define(&#39;WC_REMOVE_ALL_DATA&#39;, true); 角色 安装woocommerce之后会自动创建两个角色\n1、店铺管理员（Shop manager）\n2、顾客（Customer）\n固定链接 后台-&gt;设置-&gt;固定链接\n">
<title>Woocommerce主题开发</title>

<link rel='canonical' href='https://hollisho.github.io/p/woocommerce%E4%B8%BB%E9%A2%98%E5%BC%80%E5%8F%91/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Woocommerce主题开发">
<meta property='og:description' content="卸载 是否保留数据 1 2 //告诉WCC，删除插件的时候，是否保留数据 define(&#39;WC_REMOVE_ALL_DATA&#39;, true); 角色 安装woocommerce之后会自动创建两个角色\n1、店铺管理员（Shop manager）\n2、顾客（Customer）\n固定链接 后台-&gt;设置-&gt;固定链接\n">
<meta property='og:url' content='https://hollisho.github.io/p/woocommerce%E4%B8%BB%E9%A2%98%E5%BC%80%E5%8F%91/'>
<meta property='og:site_name' content='HoCode'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='wordpress' /><meta property='article:tag' content=' woocommerce' /><meta property='article:published_time' content='2024-03-24T16:35:45&#43;08:00'/><meta property='article:modified_time' content='2024-03-24T16:35:45&#43;08:00'/>
<meta name="twitter:title" content="Woocommerce主题开发">
<meta name="twitter:description" content="卸载 是否保留数据 1 2 //告诉WCC，删除插件的时候，是否保留数据 define(&#39;WC_REMOVE_ALL_DATA&#39;, true); 角色 安装woocommerce之后会自动创建两个角色\n1、店铺管理员（Shop manager）\n2、顾客（Customer）\n固定链接 后台-&gt;设置-&gt;固定链接\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_1badc3931a35b1a0.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🧐</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">HoCode</a></h1>
            <h2 class="site-description">闲静少言，不慕荣利。好读书，不求甚解；每有会意，便欣然忘食。</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/hollisho'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://gitee.com/hollisho'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Gitee</title><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>首页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>技术链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#卸载">卸载</a>
      <ol>
        <li><a href="#是否保留数据">是否保留数据</a></li>
      </ol>
    </li>
    <li><a href="#角色">角色</a></li>
    <li><a href="#固定链接">固定链接</a>
      <ol>
        <li><a href="#产品固定链接">产品固定链接</a></li>
      </ol>
    </li>
    <li><a href="#产品常规设置">产品常规设置</a>
      <ol>
        <li><a href="#评论设置">评论设置</a></li>
        <li><a href="#库存设置">库存设置</a></li>
        <li><a href="#可下载设置">可下载设置</a></li>
      </ol>
    </li>
    <li><a href="#配送设置">配送设置</a>
      <ol>
        <li><a href="#配送方式">配送方式</a>
          <ol>
            <li><a href="#免费配送">免费配送</a></li>
            <li><a href="#标准运费统一费率">标准运费（统一费率）</a></li>
          </ol>
        </li>
        <li><a href="#本地自提">本地自提</a></li>
        <li><a href="#通过代码设置">通过代码设置</a></li>
        <li><a href="#配送类型">配送类型</a></li>
      </ol>
    </li>
    <li><a href="#结算设置">结算设置</a>
      <ol>
        <li><a href="#优惠券使用">优惠券使用</a></li>
      </ol>
    </li>
    <li><a href="#api设置">API设置</a>
      <ol>
        <li><a href="#rest-api">Rest API</a></li>
        <li><a href="#webhook">Webhook</a></li>
      </ol>
    </li>
    <li><a href="#优惠券">优惠券</a>
      <ol>
        <li><a href="#常规">常规</a></li>
        <li><a href="#使用限制">使用限制</a></li>
        <li><a href="#使用次数">使用次数</a></li>
      </ol>
    </li>
    <li><a href="#订单">订单</a>
      <ol>
        <li><a href="#状态-7种">状态 (7种)</a></li>
        <li><a href="#动作">动作</a></li>
      </ol>
    </li>
    <li><a href="#产品">产品</a>
      <ol>
        <li><a href="#发布">发布</a>
          <ol>
            <li><a href="#发布时间">发布时间</a></li>
            <li><a href="#目录可见">目录可见</a></li>
          </ol>
        </li>
        <li><a href="#产品数据">产品数据</a>
          <ol>
            <li><a href="#产品类型">产品类型</a></li>
          </ol>
        </li>
        <li><a href="#库存">库存</a></li>
        <li><a href="#全局变量product">全局变量$product</a></li>
        <li><a href="#产品相关数据查询">产品相关数据查询</a>
          <ol>
            <li><a href="#产品id">产品ID</a></li>
            <li><a href="#产品图片查询">产品图片查询</a></li>
            <li><a href="#产品相册">产品相册</a></li>
            <li><a href="#产品其他信息">产品其他信息</a></li>
          </ol>
        </li>
        <li><a href="#产品自定义查询示例">产品自定义查询示例</a></li>
        <li><a href="#产品可见性product_visibility">产品可见性(product_visibility)</a></li>
        <li><a href="#产品可见性页面设置中对应的值">产品可见性页面设置中对应的值</a></li>
        <li><a href="#产品可见性查询示例">产品可见性查询示例</a></li>
      </ol>
    </li>
    <li><a href="#模板层级">模板层级</a>
      <ol>
        <li><a href="#开启主题对woocommerce支持">开启主题对woocommerce支持</a></li>
        <li><a href="#产品详情页模板层级">产品详情页模板层级</a></li>
        <li><a href="#产品分类归档页模板层级">产品分类归档页模板层级</a></li>
        <li><a href="#产品标签归档页模板层级">产品标签归档页模板层级</a></li>
        <li><a href="#全局属性归档页模板层级">全局属性归档页模板层级</a></li>
        <li><a href="#wcc创建的页面模板层级">WCC创建的页面模板层级</a>
          <ol>
            <li><a href="#店铺页面">店铺页面</a></li>
            <li><a href="#我的账户页">我的账户页</a></li>
            <li><a href="#结算页">结算页</a></li>
            <li><a href="#购物车页">购物车页</a></li>
            <li><a href="#用户协议页">用户协议页</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#wcc条件标签">WCC条件标签</a>
      <ol>
        <li><a href="#是否woocommerce页面">是否woocommerce页面</a></li>
        <li><a href="#是否店铺页">是否店铺页</a></li>
        <li><a href="#是否产品分类页">是否产品分类页</a></li>
        <li><a href="#是否产品标签页">是否产品标签页</a></li>
        <li><a href="#是否产品详情页">是否产品详情页</a></li>
        <li><a href="#是否购物车页">是否购物车页</a></li>
        <li><a href="#是否是结算页">是否是结算页</a></li>
        <li><a href="#是否是账户页">是否是账户页</a></li>
        <li><a href="#是否产品相关的分类方式归档页">是否产品相关的分类方式归档页</a></li>
        <li><a href="#更多条件标签">更多条件标签</a></li>
      </ol>
    </li>
    <li><a href="#wcc短代码">WCC短代码</a>
      <ol>
        <li><a href="#短代码的执行">短代码的执行</a></li>
        <li><a href="#购物车页面短代码">购物车页面短代码</a></li>
        <li><a href="#结算页面短代码">结算页面短代码</a></li>
        <li><a href="#账户页面短代码">账户页面短代码</a>
          <ol>
            <li></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#wcc主题开发">WCC主题开发</a>
      <ol>
        <li><a href="#样式和脚本">样式和脚本</a></li>
        <li><a href="#移除wcc自带的样式和脚本">移除WCC自带的样式和脚本</a></li>
        <li><a href="#声明支持wcc">声明支持WCC</a></li>
        <li><a href="#自主式主题开发">自主式主题开发</a></li>
        <li><a href="#覆盖式主题开发">覆盖式主题开发</a></li>
        <li><a href="#重要函数">重要函数</a></li>
        <li><a href="#主题开发要点串联">主题开发要点串联</a>
          <ol>
            <li><a href="#制作详情页顶部导航">制作详情页顶部导航</a></li>
            <li><a href="#商品搜索框">商品搜索框</a></li>
            <li><a href="#面包屑导航">面包屑导航</a></li>
            <li><a href="#获取产品信息">获取产品信息</a></li>
          </ol>
        </li>
        <li><a href="#加入购物车">加入购物车</a>
          <ol>
            <li><a href="#wcc默认方式">wcc默认方式</a></li>
            <li><a href="#自定义ajax方式">自定义ajax方式</a></li>
            <li><a href="#获取购物车中的产品数量">获取购物车中的产品数量</a></li>
            <li><a href="#计算商品总价格">计算商品总价格</a></li>
          </ol>
        </li>
        <li><a href="#列表分页">列表分页</a></li>
        <li><a href="#产品排序">产品排序</a></li>
        <li><a href="#获取指定产品分类数据">获取指定产品分类数据</a></li>
      </ol>
    </li>
    <li><a href="#wcc支付网关">WCC支付网关</a>
      <ol>
        <li><a href="#woocommerce下单流程关键代码">woocommerce下单流程关键代码</a></li>
        <li><a href="#判断woocommerce是否启用">判断woocommerce是否启用</a></li>
        <li><a href="#告诉woocommerce新增的网关">告诉woocommerce新增的网关</a></li>
        <li><a href="#必须调用的方法">必须调用的方法</a></li>
        <li><a href="#保存后台设置的数据">保存后台设置的数据</a></li>
        <li><a href="#异步回调">异步回调</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/wordpress/" style="background-color: #2a9d8f; color: #fff;">
                Wordpress
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/woocommerce%E4%B8%BB%E9%A2%98%E5%BC%80%E5%8F%91/">Woocommerce主题开发</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-03-24 16:35</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="卸载">卸载
</h2><h3 id="是否保留数据">是否保留数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//告诉WCC，删除插件的时候，是否保留数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;WC_REMOVE_ALL_DATA&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="角色">角色
</h2><p>安装woocommerce之后会自动创建两个角色</p>
<p>1、店铺管理员（Shop manager）</p>
<p>2、顾客（Customer）</p>
<h2 id="固定链接">固定链接
</h2><blockquote>
<p>后台-&gt;设置-&gt;固定链接</p></blockquote>
<h3 id="产品固定链接">产品固定链接
</h3><ul>
<li>默认</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">://</span><span class="nx">wordpress</span><span class="o">.</span><span class="nx">localhost</span><span class="o">/</span><span class="nx">product</span><span class="o">/</span><span class="nx">sample</span><span class="o">-</span><span class="nx">product</span><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>商店基础链接</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">://</span><span class="nx">wordpress</span><span class="o">.</span><span class="nx">localhost</span><span class="o">/</span><span class="nx">shop</span><span class="o">/</span><span class="nx">sample</span><span class="o">-</span><span class="nx">product</span><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>添加网店和分类目录地址</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">://</span><span class="nx">wordpress</span><span class="o">.</span><span class="nx">localhost</span><span class="o">/</span><span class="nx">shop</span><span class="o">/</span><span class="nx">product</span><span class="o">-</span><span class="nx">category</span><span class="o">/</span><span class="nx">sample</span><span class="o">-</span><span class="nx">product</span><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>自定义基础链接</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//输入个自定义base，它必须被设置，否则 WordPress 会使用默认值替代.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="nx">product</span><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="产品常规设置">产品常规设置
</h2><h3 id="评论设置">评论设置
</h3><ul>
<li>
<p>启用产品评价</p>
</li>
<li>
<p>用户评论时显示”已验证的所有者“标签（用来标识用户是否为已购买的用户）</p>
</li>
<li>
<p>仅”已验证的用户“可参与评价（已购买的用户才可以评价）</p>
</li>
</ul>
<h3 id="库存设置">库存设置
</h3><ul>
<li>保留库存（保留库存（为未支付订单）x 分钟。当达到限制时间时，待付款的订单将会被取消。留空则一直保留，不会自动取消订单。）</li>
<li>库存不足的最低值（当库存数量达到这个数量时，会发送通知）</li>
<li>售罄的最低值（当库存达到这里数量时，库存状态将会改编为”售罄“，并发送通知）</li>
</ul>
<h3 id="可下载设置">可下载设置
</h3><ul>
<li>文件下载方法
<ul>
<li>强制下载</li>
<li>X-Accel-Redirect/X-Sendfile（需要服务器配置）</li>
<li>仅重定向（在发布产品时，可以设置对应文件的url）</li>
</ul>
</li>
<li>访问限制
<ul>
<li>下载必须登录</li>
<li>支付后授权访问可下载产品（启用此选项时当下载订单状态为“正在处理”，而非“已完成”，授权访问下载资源。否则，订单状态为”已完成“才能下载）</li>
</ul>
</li>
</ul>
<h2 id="配送设置">配送设置
</h2><h3 id="配送方式">配送方式
</h3><h4 id="免费配送">免费配送
</h4><ul>
<li>N/A （无限制）</li>
<li>免费送货需要免费送货券</li>
<li>最小订单金额</li>
<li>最小订单金额或优惠券</li>
<li>最小订单金额和优惠券</li>
</ul>
<h4 id="标准运费统一费率">标准运费（统一费率）
</h4><ul>
<li>
<p>税状态</p>
<ul>
<li>应纳税</li>
<li>无</li>
</ul>
</li>
<li>
<p>成本</p>
<ul>
<li>设置固定值</li>
<li>设置表达式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//[qty]表示商品数量
</span></span><span class="line"><span class="cl">//[cost]表示商品总额
</span></span><span class="line"><span class="cl">//[fee percent=&#34;10&#34; min_fee=&#34;20&#34; max_fee=&#34;&#34;]
</span></span><span class="line"><span class="cl">//运费每件商品10元
</span></span><span class="line"><span class="cl">10*[qty]
</span></span><span class="line"><span class="cl">//运费为商品总额的10%
</span></span><span class="line"><span class="cl">[cost]*0.1
</span></span><span class="line"><span class="cl">[fee percent=&#34;10&#34;]
</span></span><span class="line"><span class="cl">//运费为商品总额的10%，最低收5元，最高30元
</span></span><span class="line"><span class="cl">[fee percent=&#34;10&#34; min_fee=&#34;5&#34; max_fee=&#34;30&#34;]
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="本地自提">本地自提
</h3><ul>
<li>税状态
<ul>
<li>应纳税</li>
<li>无</li>
</ul>
</li>
<li>成本（只能设置固定值）</li>
</ul>
<h3 id="通过代码设置">通过代码设置
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//如果配送符合免费，则仅仅展示免费
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;woocommerce_package_rates&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$rates</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$free</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$rates</span> <span class="k">as</span> <span class="nv">$rate_id</span> <span class="o">=&gt;</span> <span class="nv">$rate</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;free_shipping&#39;</span> <span class="o">===</span> <span class="nv">$rate</span><span class="o">-&gt;</span><span class="na">method_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$free</span><span class="p">[</span><span class="nv">$rate_id</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$rate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$free</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$free</span> <span class="o">:</span> <span class="nv">$rates</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配送类型">配送类型
</h3><blockquote>
<p>”配送类型“针对单个产品设置的，可以看作是”配送方式-&gt;统一费率（标准运费）“中更细粒度的设置</p></blockquote>
<ul>
<li>产品编辑页面可以单独设置运费类别</li>
</ul>
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240604172601948.png" alt="image-20240604172601948" style="zoom:50%;" />
<ul>
<li>如果设置了”配送类型“，在统一费率的编辑界面可以设置”配送类型“的费用。
<ul>
<li>配送类型的费用也可以采用前面成本中的公式[qty]、[cost]等</li>
<li>如果设置了成本和配送类型的费用，实际的运费是两者的计算结果之和</li>
</ul>
</li>
</ul>
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240604174707331.png" alt="image-20240604174707331" style="zoom:50%;" />
<ul>
<li>计算方式
<ul>
<li>每个配送类型：每个配送类型单独收费</li>
<li>每个订单：按最贵的配送类型进行收费</li>
</ul>
</li>
</ul>
<h2 id="结算设置">结算设置
</h2><h3 id="优惠券使用">优惠券使用
</h3><ul>
<li>启用优惠代码的使用</li>
</ul>
<p>是否启用优惠券功能</p>
<ul>
<li>顺序计算优惠券折扣</li>
</ul>
<p>当应用多个优惠券，应用第一个优惠券的全价和第二优待券的折扣价格等。</p>
<p>即：按顺序，先根据前面的优惠券计算出应付价格，再结合后面的优惠券计算折扣。</p>
<h2 id="api设置">API设置
</h2><h3 id="rest-api">Rest API
</h3><blockquote>
<p>查看所有的路由：http://wordpress.localhost/wp-json/wc/v2</p></blockquote>
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240606142007638.png" alt="image-20240606142007638" style="zoom:50%;" />
<ul>
<li>生成Api Key</li>
<li>OAuth 1.0 （http）</li>
<li>Basic Auth （https）</li>
</ul>
<h3 id="webhook">Webhook
</h3><blockquote>
<p>特定的时候要求wcc向指定的页面发送post请求。webbook是一种通知机制。</p></blockquote>
<h2 id="优惠券">优惠券
</h2><h3 id="常规">常规
</h3><ul>
<li>
<p>折扣类型</p>
<ul>
<li>百分比优惠</li>
</ul>
<p>优惠券的金额就是比例，如：10 标识 10%的优惠</p>
<ul>
<li>固定的购物车优惠</li>
</ul>
<p>整个购物车固定金额的优惠。如果购物车中的商品总金额小于优惠券金额，则优惠总额为商品总金额</p>
<ul>
<li>固定的产品优惠</li>
</ul>
<p>按产品数据计算优惠。如产品数量为2，优惠券金额为8，则优惠金额为2*8=16</p>
</li>
<li>
<p>优惠券金额</p>
</li>
<li>
<p>允许免运费</p>
</li>
</ul>
<p>要配合配送方式中的免费配送的设置使用。其中免费送货需要免费送货券、最小订单金额或优惠券、最小订单金额和优惠券这三个设置都可以</p>
<ul>
<li>优惠券过期时间</li>
</ul>
<p>精确到天，过期时间为设置日期的00:00:00</p>
<h3 id="使用限制">使用限制
</h3><ul>
<li>最低花费金额</li>
<li>最高花费金额</li>
<li>仅限单独使用</li>
</ul>
<p>如果优惠券不能与其他优惠券一起使用请勾选此框</p>
<ul>
<li>不含促销产品</li>
</ul>
<p>如果优惠券不适用用于促销产品，请选中该复选框。基于物品的优惠券仅在该物品非促销时可用。基于购物车的优惠券仅在购物车内无促销产品时可用</p>
<ul>
<li>产品</li>
<li>排除产品</li>
</ul>
<p>折扣类型是固定的购物车优惠时候，如果购物车中包含了排除的产品，整个购物车都无法使用该优惠券</p>
<ul>
<li>产品类别</li>
<li>排除类别</li>
<li>获准的电子邮件</li>
</ul>
<h3 id="使用次数">使用次数
</h3><ul>
<li>每个优惠券的使用次数限制</li>
<li>限制x个物品使用 （只用于折扣类型：百分比优惠、固定的产品优惠）</li>
</ul>
<p>如果购物车中有多个商品，优先级为 数量 &gt; 金额</p>
<ul>
<li>每个用户的使用次数限制</li>
</ul>
<h2 id="订单">订单
</h2><h3 id="状态-7种">状态 (7种)
</h3><ul>
<li>待付款 （Pending payment）</li>
<li>正在处理（Processing）</li>
<li>保留（On hold）</li>
<li>已完成（Completed）</li>
<li>已取消（Cancelled）</li>
<li>已退款（Refunded）</li>
<li>失败订单（Failed）</li>
</ul>
<h3 id="动作">动作
</h3><ul>
<li>发给客户的邮件收据/订单详情</li>
<li>重新发送新订单通知 （发送给管理员）</li>
<li>重新生成下载权限 （下载剩余次数会被重置）</li>
</ul>
<h2 id="产品">产品
</h2><h3 id="发布">发布
</h3><h4 id="发布时间">发布时间
</h4><p>可用于实现定时发布的功能，仅当当前时间大于发布时间，产品才显示</p>
<h4 id="目录可见">目录可见
</h4><ul>
<li>商店页和搜索结果页</li>
<li>仅商店页</li>
<li>仅搜索结果页</li>
<li>隐藏</li>
</ul>
<h3 id="产品数据">产品数据
</h3><h4 id="产品类型">产品类型
</h4><ul>
<li>单个产品
<ul>
<li>实物产品
<ul>
<li>可下载</li>
</ul>
</li>
<li>虚拟产品
<ul>
<li>可下载</li>
</ul>
</li>
</ul>
</li>
<li>成组产品 （包含多个产品，类似套餐）</li>
<li>外接/关联产品</li>
<li>可变产品 （产品的多个属性可选，可以选择不同组合。如：产品尺寸，产品颜色，不同颜色和不同尺寸组成不同的组合。）
<ul>
<li>属性 （可以勾上是否用于变量）</li>
<li>变量
<ul>
<li>自动生成 （自动根据勾选用于变量的属性，通过组合方式生成不同的变量，即：可能产品）</li>
<li>手动添加</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240607135551148.png" alt="image-20240607135551148" style="zoom:50%;" />
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240607135606946.png" alt="image-20240607135606946" style="zoom:50%;" />
<h3 id="库存">库存
</h3><ul>
<li>SKU</li>
</ul>
<p>SKU，即库存单位，是一种可以帮助零售商识别最小库存持有量的代码。每个 SKU 都是独一无二的，代表了一个特定的商品，包括它的型号、尺寸、颜色等属性。</p>
<ul>
<li>允许缺货超售？
<ul>
<li>不允许</li>
<li>允许</li>
<li>允许，但通知客户  （客户购买后，会在邮件通知中显示”延迟交货“）</li>
</ul>
</li>
</ul>
<h3 id="全局变量product">全局变量$product
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="k">if</span><span class="p">(</span><span class="n">have_posts</span><span class="p">()):</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="k">while</span><span class="p">(</span><span class="n">have_post</span><span class="p">()):</span><span class="n">the_post</span><span class="p">();</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="n">global</span> <span class="o">$</span><span class="n">product</span><span class="p">;</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">		    <span class="o">&lt;!--</span> <span class="n">simple</span><span class="err">：单个产品</span> <span class="n">external</span><span class="err">：外接</span><span class="o">/</span><span class="err">关联产品</span> <span class="n">grouped</span><span class="err">：成组产品</span> <span class="n">variable</span><span class="err">：可变产品</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="n">echo</span> <span class="o">$</span><span class="n">product</span><span class="o">-&gt;</span><span class="n">get_type</span><span class="p">();</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="n">endwhile</span><span class="p">;</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="n">endif</span><span class="p">;</span> <span class="err">?</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品相关数据查询">产品相关数据查询
</h3><h4 id="产品id">产品ID
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php if(have_posts()): ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php while(have_post()):the_post(); ?&gt;
</span></span><span class="line"><span class="cl">		&lt;?php global $product, $post; ?&gt;
</span></span><span class="line"><span class="cl">		&lt;h2&gt;产品ID&lt;/h2&gt;
</span></span><span class="line"><span class="cl">        &lt;?php echo $product-&gt;get_id(); ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php echo get_the_ID(); ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php echo $post-&gt;ID; ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php echo get_queried_object_id(); ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php endwhile; ?&gt;
</span></span><span class="line"><span class="cl">&lt;?php endif; ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="产品图片查询">产品图片查询
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!-- 新版woocommerce没有产品图片设置页面,可以通过代码自定图片尺寸 --&gt;
</span></span><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">add_image_size(&#39;shop_catalog&#39;, 300, 300, true);
</span></span><span class="line"><span class="cl">add_image_size(&#39;shop_single&#39;, 600, 600, true);
</span></span><span class="line"><span class="cl">add_image_size(&#39;shop_thumbnail&#39;, 180, 180, true);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//新版提供了新的方法
</span></span><span class="line"><span class="cl">//single、gallery_thumbnail、thumbnail
</span></span><span class="line"><span class="cl">wc_get_image_size(&#39;single&#39;);
</span></span><span class="line"><span class="cl">?&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;?php if(have_posts()): ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php while(have_post()):the_post(); ?&gt;
</span></span><span class="line"><span class="cl">		&lt;?php global $product; ?&gt;
</span></span><span class="line"><span class="cl">		&lt;h2&gt;产品图片&lt;/h2&gt;
</span></span><span class="line"><span class="cl">        &lt;?php the_post_thumbnail(&#39;shop_catalog&#39;);//目录图片 ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php the_post_thumbnail(&#39;shop_single&#39;);//产品详情页的产品图片 ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php the_post_thumbnail(&#39;shop_thumbnail&#39;);//产品缩略图 ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php endwhile; ?&gt;
</span></span><span class="line"><span class="cl">&lt;?php endif; ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="产品相册">产品相册
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php if(have_posts()): ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php while(have_post()):the_post(); ?&gt;
</span></span><span class="line"><span class="cl">		&lt;?php global $product; ?&gt;
</span></span><span class="line"><span class="cl">		&lt;h2&gt;产品相册&lt;/h2&gt;
</span></span><span class="line"><span class="cl">        &lt;?php foreach($product-&gt;get_gallery_image_ids() as $aid): ?&gt;
</span></span><span class="line"><span class="cl">        &lt;?php echo wp_get_attachment_image($aid, &#39;shop_thumbnail&#39;); ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php endwhile; ?&gt;
</span></span><span class="line"><span class="cl">&lt;?php endif; ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="产品其他信息">产品其他信息
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php if(have_posts()): ?&gt;
</span></span><span class="line"><span class="cl">	&lt;?php while(have_post()):the_post(); ?&gt;
</span></span><span class="line"><span class="cl">		&lt;?php global $product; ?&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品标题&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $post-&gt;post_title; ?&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $product-&gt;get_name(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品价格&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $post-&gt;get_price_html(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品简介&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php the_excerpt(); ?&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $product-&gt;get_short_description(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品货号&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $product-&gt;get_sku(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品正文&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo $product-&gt;get_description(); ?&gt;
</span></span><span class="line"><span class="cl">            &lt;?php the_content(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品属性&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo wc_display_product_attributes($product); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品所属分类&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo wc_get_product_category_list($product-&gt;get_id(), &#39;-&#39;); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;产品所属标签&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php echo wc_get_product_tag_list($product-&gt;get_id(), &#39;-&#39;); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;加入购物车&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php woocommerce_template_single_add_to_cat(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;增销产品&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php
</span></span><span class="line"><span class="cl">            //$limit 显示数量 -1显示全部
</span></span><span class="line"><span class="cl">            //$columns 每行显示几个
</span></span><span class="line"><span class="cl">            //woocommerce_upsell_display($limit, $columns, $orderby, $order);
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            ?&gt;
</span></span><span class="line"><span class="cl">            &lt;?php woocommerce_upsell_display(); ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">		&lt;div&gt;
</span></span><span class="line"><span class="cl">            &lt;h2&gt;相关产品&lt;/h2&gt;
</span></span><span class="line"><span class="cl">            &lt;?php 
</span></span><span class="line"><span class="cl">            // orderby: rand,title,ID,date,modified,menu_order,price
</span></span><span class="line"><span class="cl">            $defauls = [
</span></span><span class="line"><span class="cl">                &#39;posts_per_page&#39; =&gt; 1,
</span></span><span class="line"><span class="cl">                &#39;columns&#39;        =&gt; 2,
</span></span><span class="line"><span class="cl">                &#39;orderby&#39;        =&gt; &#39;rand&#39;,
</span></span><span class="line"><span class="cl">                &#39;order&#39;          =&gt; &#39;desc&#39;
</span></span><span class="line"><span class="cl">            ];
</span></span><span class="line"><span class="cl">          	woocommerce_related_products($defauls); 
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            ?&gt;
</span></span><span class="line"><span class="cl">    	&lt;/div&gt;
</span></span><span class="line"><span class="cl">	&lt;?php endwhile; ?&gt;
</span></span><span class="line"><span class="cl">&lt;?php endif; ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品自定义查询示例">产品自定义查询示例
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 获取所有有货、店铺页可见 (NOT IN (outofstock, exclude-from-catalog))
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 并且
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 在别名为phone的产品分类中或者在别名为hot的产品标签中的
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 所有产品
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Query</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;post_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;posts_per_page&#39;</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;tax_query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;relation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_visibility&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;exclude-from-catalog&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;outofstock&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;operator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;NOT IN&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;relation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_cat&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_tag&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">have_post</span><span class="p">())</span> <span class="k">while</span><span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">have_post</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">the_post</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$global</span> <span class="nv">$product</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_id</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">the_ID</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">wp_reset_postdata</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品可见性product_visibility">产品可见性(product_visibility)
</h3><ul>
<li><code>exclude-from-search</code></li>
</ul>
<p>所有在搜索结果中排除的产品，都在此分类项目中</p>
<ul>
<li><code>exclude-from-catalog</code></li>
</ul>
<p>所有从店铺页或分类归档页中排除的产品，都在此分类项目中</p>
<ul>
<li><code>featured</code></li>
</ul>
<p>所有推荐的产品，都在此分类项目中</p>
<ul>
<li><code>outofstock</code></li>
</ul>
<p>所有没有库存的产品，都在此分类项目中</p>
<ul>
<li><code>rated-1</code></li>
</ul>
<p>1星评价</p>
<ul>
<li><code>rated-2</code></li>
</ul>
<p>2星评价</p>
<ul>
<li><code>rated-3</code></li>
</ul>
<p>3星评价</p>
<ul>
<li><code>rated-4</code></li>
</ul>
<p>4星评价</p>
<ul>
<li><code>rated-5</code></li>
</ul>
<p>5星评价</p>
<h3 id="产品可见性页面设置中对应的值">产品可见性页面设置中对应的值
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 1.商店页和搜索结果页
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s2">&#34;product_visibility NOT IN (&#39;exclude-from-catalog&#39;, &#39;exclude-from-search&#39;)&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2.仅商店页
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s2">&#34;product_visibility IN (&#39;exclude-from-search&#39;)&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 3.仅搜索结果页
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s2">&#34;product_visibility IN (&#39;exclude-from-catalog&#39;)&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 4.隐藏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s2">&#34;product_visibility IN (&#39;exclude-from-catalog&#39;, &#39;exclude-from-search&#39;)&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 5.推荐产品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s2">&#34;product_visibility IN (&#39;featured&#39;)&#34;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240607161128729.png" alt="image-20240607161128729" style="zoom:50%;" />
<img src="C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20240607161350580.png" alt="image-20240607161350580" style="zoom:50%;" />
<h3 id="产品可见性查询示例">产品可见性查询示例
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 获取所有有货、店铺页可见 (NOT IN (outofstock, exclude-from-catalog))
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 并且
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 在别名为other的产品分类中的
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 所有产品
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Query</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;post_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;posts_per_page&#39;</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;tax_query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;relation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_visibility&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;exclude-from-catalog&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;outofstock&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;operator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;NOT IN&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_cat&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="模板层级">模板层级
</h2><h3 id="开启主题对woocommerce支持">开启主题对woocommerce支持
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;after_setup_theme&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 开启woocommerce支持，后面的模板层级才生效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">add_theme_support</span><span class="p">(</span><span class="s1">&#39;woocommerce&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品详情页模板层级">产品详情页模板层级
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$custom</span><span class="o">.</span><span class="nx">php</span>                                       <span class="c1">//自定义模板文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">single</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">single</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">/</span><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">single</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>  <span class="c1">//wcc插件中的模板文件
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品分类归档页模板层级">产品分类归档页模板层级
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_cat</span><span class="o">-</span><span class="nv">$slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocomerce</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_cat</span><span class="o">-</span><span class="nv">$slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_cat</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">taxonomu</span><span class="o">-</span><span class="nx">product_cat</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">/</span><span class="nx">woocomerce</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_cat</span><span class="o">.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品标签归档页模板层级">产品标签归档页模板层级
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_tag</span><span class="o">-</span><span class="nv">$slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">proudct_tag</span><span class="o">-</span><span class="nv">$slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_tag</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_tag</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">/</span><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">product_tag</span><span class="o">.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="全局属性归档页模板层级">全局属性归档页模板层级
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">pa_</span><span class="nv">$attr_slug</span><span class="o">-</span><span class="nv">$term_slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocomerce</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">pa_</span><span class="nv">$attr_slug</span><span class="o">-</span><span class="nv">$term_slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">pa_</span><span class="nv">$attr_slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocomerce</span><span class="o">/</span><span class="nx">taxonomy</span><span class="o">-</span><span class="nx">pa_</span><span class="nv">$attr_slug</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">/</span><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="wcc创建的页面模板层级">WCC创建的页面模板层级
</h3><h4 id="店铺页面">店铺页面
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocomerce</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">/</span><span class="nx">woocomerce</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">archive</span><span class="o">-</span><span class="nx">product</span><span class="o">.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="我的账户页">我的账户页
</h4><p>普通页面，按照wordpress默认的模板层级规则来</p>
<h4 id="结算页">结算页
</h4><p>普通页面，按照wordpress默认的模板层级规则来</p>
<h4 id="购物车页">购物车页
</h4><p>普通页面，按照wordpress默认的模板层级规则来</p>
<h4 id="用户协议页">用户协议页
</h4><p>普通页面，按照wordpress默认的模板层级规则来</p>
<h2 id="wcc条件标签">WCC条件标签
</h2><h3 id="是否woocommerce页面">是否woocommerce页面
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_woocommerce - Returns true if on a page which uses WooCommerce templates (cart and checkout are standard pages with shortcodes and thus are not included).
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_woocommerce</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;is_woocommerce&#39;</span><span class="p">,</span> <span class="nx">is_shop</span><span class="p">()</span> <span class="o">||</span> <span class="nx">is_product_taxonomy</span><span class="p">()</span> <span class="o">||</span> <span class="nx">is_product</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否店铺页">是否店铺页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_shop - Returns true when viewing the product type archive (shop).
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_shop</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span> <span class="nx">is_post_type_archive</span><span class="p">(</span> <span class="s1">&#39;product&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">is_page</span><span class="p">(</span> <span class="nx">wc_get_page_id</span><span class="p">(</span> <span class="s1">&#39;shop&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否产品分类页">是否产品分类页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_product_category - Returns true when viewing a product category.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param  string $term (default: &#39;&#39;) The term slug your checking for. Leave blank to return true on any.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_product_category</span><span class="p">(</span> <span class="nv">$term</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">is_tax</span><span class="p">(</span> <span class="s1">&#39;product_cat&#39;</span><span class="p">,</span> <span class="nv">$term</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否产品标签页">是否产品标签页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_product_tag - Returns true when viewing a product tag.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param  string $term (default: &#39;&#39;) The term slug your checking for. Leave blank to return true on any.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_product_tag</span><span class="p">(</span> <span class="nv">$term</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">is_tax</span><span class="p">(</span> <span class="s1">&#39;product_tag&#39;</span><span class="p">,</span> <span class="nv">$term</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否产品详情页">是否产品详情页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_product - Returns true when viewing a single product.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_product</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">is_singular</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;product&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否购物车页">是否购物车页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_cart - Returns true when viewing the cart page.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_cart</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$page_id</span> <span class="o">=</span> <span class="nx">wc_get_page_id</span><span class="p">(</span> <span class="s1">&#39;cart&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span> <span class="nv">$page_id</span> <span class="o">&amp;&amp;</span> <span class="nx">is_page</span><span class="p">(</span> <span class="nv">$page_id</span> <span class="p">)</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">Constants</span><span class="o">::</span><span class="na">is_defined</span><span class="p">(</span> <span class="s1">&#39;WOOCOMMERCE_CART&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">wc_post_content_has_shortcode</span><span class="p">(</span> <span class="s1">&#39;woocommerce_cart&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否是结算页">是否是结算页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_checkout - Returns true when viewing the checkout page, or when processing AJAX requests for updating or processing the checkout.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_checkout</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$page_id</span> <span class="o">=</span> <span class="nx">wc_get_page_id</span><span class="p">(</span> <span class="s1">&#39;checkout&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span> <span class="nv">$page_id</span> <span class="o">&amp;&amp;</span> <span class="nx">is_page</span><span class="p">(</span> <span class="nv">$page_id</span> <span class="p">)</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">wc_post_content_has_shortcode</span><span class="p">(</span> <span class="s1">&#39;woocommerce_checkout&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;woocommerce_is_checkout&#39;</span><span class="p">,</span> <span class="k">false</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">Constants</span><span class="o">::</span><span class="na">is_defined</span><span class="p">(</span> <span class="s1">&#39;WOOCOMMERCE_CHECKOUT&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否是账户页">是否是账户页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_account_page - Returns true when viewing an account page.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_account_page</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$page_id</span> <span class="o">=</span> <span class="nx">wc_get_page_id</span><span class="p">(</span> <span class="s1">&#39;myaccount&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span> <span class="nv">$page_id</span> <span class="o">&amp;&amp;</span> <span class="nx">is_page</span><span class="p">(</span> <span class="nv">$page_id</span> <span class="p">)</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">wc_post_content_has_shortcode</span><span class="p">(</span> <span class="s1">&#39;woocommerce_my_account&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;woocommerce_is_account_page&#39;</span><span class="p">,</span> <span class="k">false</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="是否产品相关的分类方式归档页">是否产品相关的分类方式归档页
</h3><blockquote>
<p>包括产品分类、产品标签、产品属性等</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Is_product_taxonomy - Returns true when viewing a product taxonomy archive.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_product_taxonomy</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">is_tax</span><span class="p">(</span> <span class="nx">get_object_taxonomies</span><span class="p">(</span> <span class="s1">&#39;product&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="更多条件标签">更多条件标签
</h3><blockquote>
<p>所有条件标签查看：plugins/woocommerce/includes/wc-conditional-functions.php</p></blockquote>
<h2 id="wcc短代码">WCC短代码
</h2><h3 id="短代码的执行">短代码的执行
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span><span class="p">(</span><span class="nx">have_posts</span><span class="p">())</span><span class="o">:</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">	&lt;?php while(have_post()):the_post(); ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">		&lt;?php global $post; ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo do_shortcode($post-&gt;content); ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo the_content();//the_content()里面自动解析了短代码 ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">	&lt;?php endwhile; ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php endif; ?&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="购物车页面短代码">购物车页面短代码
</h3><blockquote>
<p>[woocommerce_cart]</p></blockquote>
<p><code>plugins/woocommerce/includes/class-wc-shortcodes.php</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WC_Shortcodes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * Cart page shortcode.
</span></span></span><span class="line"><span class="cl"><span class="sd">	 *
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">	 */</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">cart</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">is_null</span><span class="p">(</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">self</span><span class="o">::</span><span class="na">shortcode_wrapper</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;WC_Shortcode_Cart&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="结算页面短代码">结算页面短代码
</h3><blockquote>
<p>[woocommerce_checkout]</p></blockquote>
<p><code>plugins/woocommerce/includes/class-wc-shortcodes.php</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WC_Shortcodes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * Checkout page shortcode.
</span></span></span><span class="line"><span class="cl"><span class="sd">	 *
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * @param array $atts Attributes.
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">	 */</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">checkout</span><span class="p">(</span> <span class="nv">$atts</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">shortcode_wrapper</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;WC_Shortcode_Checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span> <span class="p">),</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="账户页面短代码">账户页面短代码
</h3><blockquote>
<p>[woocommerce_my_account]</p></blockquote>
<p><code>plugins/woocommerce/includes/class-wc-shortcodes.php</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WC_Shortcodes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * My account page shortcode.
</span></span></span><span class="line"><span class="cl"><span class="sd">	 *
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * @param array $atts Attributes.
</span></span></span><span class="line"><span class="cl"><span class="sd">	 * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">	 */</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">my_account</span><span class="p">(</span> <span class="nv">$atts</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">shortcode_wrapper</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;WC_Shortcode_My_Account&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span> <span class="p">),</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="输出notices">输出notices
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//打印所有notices
</span></span><span class="line"><span class="cl">wc_print_notices();
</span></span><span class="line"><span class="cl">//添加notice
</span></span><span class="line"><span class="cl">wc_add_notice(&#39;hello world&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wcc主题开发">WCC主题开发
</h2><h3 id="样式和脚本">样式和脚本
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 1. 通过wp_register_script()和wp_register_style(),先注册脚本和样式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wp_register_script</span><span class="p">(</span> <span class="nv">$handle</span><span class="p">,</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$deps</span><span class="p">,</span> <span class="nv">$version</span><span class="p">,</span> <span class="nv">$in_footer</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">wp_register_style</span><span class="p">(</span> <span class="nv">$handle</span><span class="p">,</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$deps</span><span class="p">,</span> <span class="nv">$version</span><span class="p">,</span> <span class="nv">$media</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. 通过wp_enqueue_script($handle)和wp_enqueue_style($handle)，调用已经注册好的脚本和样式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wp_enqueue_script</span><span class="p">(</span> <span class="s1">&#39;wc-add-to-cart-variation&#39;</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="移除wcc自带的样式和脚本">移除WCC自带的样式和脚本
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 去除wcc自带的样式，__return_empty_array是wp自带的函数，返回空数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;woocommerce_enqueue_styles&#39;</span><span class="p">,</span> <span class="s1">&#39;__return_empty_array&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 去除wcc自带的样式和脚本，load_scripts 里面执行了woocommerce_enqueue_styles过滤器钩子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">remove_action</span><span class="p">(</span> <span class="s1">&#39;wp_enqueue_scripts&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">WC_Frontend_Scripts</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;load_scripts&#39;</span> <span class="p">]</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="声明支持wcc">声明支持WCC
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;after_setup_theme&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//声明支持woocommerce
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">add_theme_support</span><span class="p">(</span><span class="s1">&#39;woocommerce&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="自主式主题开发">自主式主题开发
</h3><blockquote>
<p>自己根据WCC的模板层级，通过自定义的查询和自定义CSS、js的方式实现自己的主题</p></blockquote>
<h3 id="覆盖式主题开发">覆盖式主题开发
</h3><blockquote>
<p>在开发兼容WCC的主题时，首先考虑的不是要自己去写所有的模板，而是在WCC模板的基础上去修改。比如，去修改数据的输出结构等。把plugins/woocommerce/templates的指定的模板文件复制到当前主题/woocommerce目录下</p></blockquote>
<h3 id="重要函数">重要函数
</h3><ul>
<li>wc_get_template定义</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Get other templates (e.g. product attributes) passing attributes and including the file.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $template_name Template name.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param array  $args          Arguments. (default: array).
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $template_path Template path. (default: &#39;&#39;).
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $default_path  Default path. (default: &#39;&#39;).
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">wc_get_template</span><span class="p">(</span> <span class="nv">$template_name</span><span class="p">,</span> <span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span> <span class="nv">$template_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$default_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>wc_get_template使用举例</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">wc_get_template</span><span class="p">(</span><span class="s1">&#39;cart/cart-item-data.php&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;item_data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$item_data</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//1. 先在当前主题的woocommerce目录中查找
</span></span></span><span class="line"><span class="cl"><span class="c1">//2. 然后再到plugins/woocommerce/templates目录中查找
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>wc_get_template_part定义</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Get template part (for templates like the shop-loop).
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * WC_TEMPLATE_DEBUG_MODE will prevent overrides in themes from taking priority.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param mixed  $slug Template slug.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $name Template name (default: &#39;&#39;).
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">wc_get_template_part</span><span class="p">(</span> <span class="nv">$slug</span><span class="p">,</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>wc_get_template_part举例</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 查找shop-product.php文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_get_template_part</span><span class="p">(</span><span class="s1">&#39;shop&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//1. 在当前主题目录中查找$slug-$name.php文件
</span></span></span><span class="line"><span class="cl"><span class="c1">//2. 在当前主题的woocommerce目录查找$slug-$name.php文件
</span></span></span><span class="line"><span class="cl"><span class="c1">//3. 在plugins/woocommerce/templates目录中查找$slug-$name.php
</span></span></span><span class="line"><span class="cl"><span class="c1">//4. 在当前主题的woocommerce目录查找$slug.php
</span></span></span><span class="line"><span class="cl"><span class="c1">//5. 在plugins/woocommerce/templates目录中查找$slug.php
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="主题开发要点串联">主题开发要点串联
</h3><h4 id="制作详情页顶部导航">制作详情页顶部导航
</h4><ul>
<li>登录链接</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 获取当前访问页面的url的方法
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 在主题的function.php定义，在模板文件中使用
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">get_curr_url</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$wp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">get_home_url</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="nv">$wp</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 前台使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$curr_url</span> <span class="o">=</span> <span class="nx">get_curr_url</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$login_url</span> <span class="o">=</span> <span class="nx">wp_login_url</span><span class="p">(</span><span class="nv">$curr_url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;&lt;?php echo </span><span class="si">$login_url</span><span class="s2">; ?&gt;&#34;</span><span class="o">&gt;</span><span class="nx">登录</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>用户中心链接</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * $pagename可选的值，如下：
</span></span></span><span class="line"><span class="cl"><span class="sd"> * myaccount  我的账户页面
</span></span></span><span class="line"><span class="cl"><span class="sd"> * shop  店铺
</span></span></span><span class="line"><span class="cl"><span class="sd"> * cart  购物车
</span></span></span><span class="line"><span class="cl"><span class="sd"> * checkout  结算
</span></span></span><span class="line"><span class="cl"><span class="sd"> * terms  条款
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">wc_get_page_permalink</span><span class="p">(</span><span class="nv">$pagename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1">//我的账户页面
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_get_page_permalink</span><span class="p">(</span><span class="s1">&#39;myacount&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//购物车页面
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_get_page_permalink</span><span class="p">(</span><span class="s1">&#39;cart&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//我的账户页面的端点
</span></span></span><span class="line"><span class="cl"><span class="c1">//订单 orders
</span></span></span><span class="line"><span class="cl"><span class="c1">//查看订单  view-order
</span></span></span><span class="line"><span class="cl"><span class="c1">//下载  downloads
</span></span></span><span class="line"><span class="cl"><span class="c1">//编辑账户 edit-address
</span></span></span><span class="line"><span class="cl"><span class="c1">//地址 edit-address
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="商品搜索框">商品搜索框
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">get_product_search_form</span><span class="p">(</span><span class="nv">$echo</span> <span class="o">=</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//复制woocommerce/templates/product-searchform.php到当前主题的woocommerce目录下
</span></span></span><span class="line"><span class="cl"><span class="c1">//修改product-searchform.php内容完成定制
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="面包屑导航">面包屑导航
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;delimiter&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;&amp;nbsp;&amp;#47;&amp;nbsp;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;wrap_before&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;nav class=&#34;woocommerce-breadcrumb&#34; aria-label=&#34;Breadcrumb&#34;&gt;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;wrap_after&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;&lt;/nav&gt;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;before&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;after&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;home&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;站点首页&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce_breadcrumb</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="获取产品信息">获取产品信息
</h4><ul>
<li>产品图片</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">the_post_thumbnail_url</span><span class="p">(</span><span class="s1">&#39;shop_single&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>产品价格</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//格式化价格 $16.90
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_price</span><span class="p">(</span><span class="nv">$price</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//获取产品价格，可以设定数量和自定义价格
</span></span></span><span class="line"><span class="cl"><span class="c1">//$args可选参数，如不传递则返回一件产品的实际价格。如传递格式为[&#39;price&#39; =&gt; 123, &#39;qty&#39; =&gt; 2]，意思是：获取2件产品的价格，每件为123元。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_get_price_to_display</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="nv">$args</span> <span class="o">=</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//产品原价
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_regular_price</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//产品促销价格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_sale_price</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//产品实际价格，如果有设置促销价格就显示促销价格，否则显示产原价
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_price</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//综合应用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_price</span><span class="p">(</span><span class="nx">wc_get_price_to_display</span><span class="p">(</span><span class="nv">$product</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>获取产品重量</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param $weigth 重量的数值
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param $to_unit 转为什么单位 可取的值为 &#39;g&#39;,&#39;kg&#39;,&#39;lbs&#39;,&#39;oz&#39;
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param $from_unit 转换前的单位，可选参数。不传递会自动获取WCC设置的默认重量单位
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">wc_get_weight</span><span class="p">(</span><span class="nv">$weight</span><span class="p">,</span> <span class="nv">$to_unit</span><span class="p">,</span> <span class="nv">$from_unit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//应用举例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">wc_get_weight</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">get_weight</span><span class="p">(),</span> <span class="s1">&#39;g&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>获取商品评论信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 该方法调用的是woocommerce/templates/single-product-reviews.php
</span></span></span><span class="line"><span class="cl"><span class="c1">// 可以把single-product-reviews.php复制到当前主题woocommerce目录下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">comments_template</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="加入购物车">加入购物车
</h3><h4 id="wcc默认方式">wcc默认方式
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// 表单方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">woocommerce_template_single_add_to_cart</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ajax方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">woocommerce_template_loop_add_to_cart</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="自定义ajax方式">自定义ajax方式
</h4><blockquote>
<p>关键文件<code>plugins/woocommerce/includes/class-wc-ajax.php</code></p>
<p><code>do_action( 'wc_ajax_' . $action )</code>根据$action参数动态触发钩子，可以用于自定义?wc-ajax=自定义动作</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Check for WC Ajax request and fire action.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">do_wc_ajax</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$wp_query</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// phpcs:disable WordPress.Security.NonceVerification.Recommended
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;wc-ajax&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wp_query</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span> <span class="s1">&#39;wc-ajax&#39;</span><span class="p">,</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nx">wp_unslash</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;wc-ajax&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$action</span> <span class="o">=</span> <span class="nv">$wp_query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span> <span class="s1">&#39;wc-ajax&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$action</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">wc_ajax_headers</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$action</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$action</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;wc_ajax_&#39;</span> <span class="o">.</span> <span class="nv">$action</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">wp_die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// phpcs:enable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ajax方式加入购物车</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="n">WCC默认会向商品页面中增加JS脚本</span><span class="err">，这些脚本给我们提供了一些重要的数据。</span><span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wc_add_to_cart_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">获取加入购物车的</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">	<span class="k">var</span> <span class="n">ajax_url</span> <span class="o">=</span> <span class="n">wc_add_to_cart_params</span><span class="o">.</span><span class="n">wc_ajax_url</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%%</span><span class="s1">endpoint</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;add_to_cart&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">通过</span><span class="n">ajax把数据提交到ajax_url</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="o">$.</span><span class="n">post</span><span class="p">()</span><span class="err">发起请求</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">获取</span><span class="n">response数据</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="k">return</span> <span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">返回的数据中标明有错误时</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">error</span> <span class="o">&amp;&amp;</span> <span class="n">response</span><span class="o">.</span><span class="n">product_url</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">window</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">product_url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">如果后台设置了加入购物车后就跳转到购物车页面时</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">wc_add_to_cart_params</span><span class="o">.</span><span class="n">cart_redirect_after_add</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">window</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">wc_add_to_cart_params</span><span class="o">.</span><span class="n">cart_url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>通过钩子<code>woocommerce_add_to_cart_fragments</code>扩展购物车产品数量字段</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;woocommerce_add_to_cart_fragments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$return</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$return</span><span class="p">[</span><span class="s1">&#39;qty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">get_cart_contents_count</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="获取购物车中的产品数量">获取购物车中的产品数量
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">get_cart_contents_count</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="计算商品总价格">计算商品总价格
</h4><blockquote>
<p>通过class-wc-ajax.php中<code>do_action( 'wc_ajax_' . $action )</code>
自定义一个action，如?wc-ajax=get_product_total_price</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//在functions.php文件中添加以下方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;wc_ajax_get_product_total_price&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$product_id</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$product</span> <span class="o">=</span> <span class="nx">wc_get_product</span><span class="p">(</span><span class="nv">$product_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$total</span> <span class="o">=</span> <span class="nx">wc_get_price_to_display</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;qty&#39;</span> <span class="o">=&gt;</span> <span class="nv">$count</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$total</span> <span class="o">=</span> <span class="nx">wc_price</span><span class="p">(</span><span class="nv">$total</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">wp_send_json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="nv">$total</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span> 
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="列表分页">列表分页
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce_pagination</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="产品排序">产品排序
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce_catalog_ordering</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="获取指定产品分类数据">获取指定产品分类数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$term_id</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* @var $term WP_Term */</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term</span> <span class="o">=</span> <span class="nx">get_term</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">,</span> <span class="s1">&#39;product_cat&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term_url</span> <span class="o">=</span> <span class="nx">get_term_link</span><span class="p">(</span><span class="nv">$term</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取&lt;img&gt;&lt;/img&gt;格式的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">woocommerce_subcategory_thumbnail</span><span class="p">(</span><span class="nv">$term</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取图片url
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$term_thumbnail_id</span> <span class="o">=</span> <span class="nx">get_term_meta</span><span class="p">(</span><span class="nv">$term_id</span><span class="p">,</span> <span class="s1">&#39;thumbnail_id&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$term_thumbnail_url</span> <span class="o">=</span> <span class="nx">wp_get_attachment_image_url</span><span class="p">(</span><span class="nv">$term_thumbnail_id</span><span class="p">,</span> <span class="s1">&#39;thumbnail&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//通过自定义查询获取分类下的产品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Query</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;post_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;posts_per_page&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;tax_query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ralation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_visibility&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;exculde-from-catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;outofstock&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;operator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;NOT IN&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;taxonomy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_cat&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;terms&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;shuiguo&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">have_posts</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">the_post</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//获取产品具体信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wcc支付网关">WCC支付网关
</h2><h3 id="woocommerce下单流程关键代码">woocommerce下单流程关键代码
</h3><ul>
<li>流程</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">includes</span><span class="o">/</span><span class="nx">class</span><span class="o">-</span><span class="nx">wc</span><span class="o">-</span><span class="nx">ajax</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nx">do_wc_ajax</span><span class="p">()</span> <span class="o">===&gt;</span> <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;wc_ajax_&#39;</span> <span class="o">.</span> <span class="nv">$action</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 结算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">checkout</span><span class="p">()</span> <span class="o">===&gt;</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">process_checkout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">woocommerce</span><span class="o">/</span><span class="nx">includes</span><span class="o">/</span><span class="nx">class</span><span class="o">-</span><span class="nx">wc</span><span class="o">-</span><span class="nx">checkout</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 下单
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">process_checkout</span><span class="p">()</span> <span class="o">===&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">process_order_payment</span><span class="p">(</span> <span class="nv">$order_id</span><span class="p">,</span> <span class="nv">$posted_data</span><span class="p">[</span><span class="s1">&#39;payment_method&#39;</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 获取支付网关中指定的支付方式，执行该支付方式的process_payment()方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">process_order_payment</span><span class="p">()</span> <span class="o">===&gt;</span> <span class="nv">$available_gateways</span><span class="p">[</span> <span class="nv">$payment_method</span> <span class="p">]</span><span class="o">-&gt;</span><span class="na">process_payment</span><span class="p">(</span> <span class="nv">$order_id</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>woocommerce/includes/class-wc-ajax.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Check for WC Ajax request and fire action.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">do_wc_ajax</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$wp_query</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// phpcs:disable WordPress.Security.NonceVerification.Recommended
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;wc-ajax&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wp_query</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span> <span class="s1">&#39;wc-ajax&#39;</span><span class="p">,</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nx">wp_unslash</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;wc-ajax&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$action</span> <span class="o">=</span> <span class="nv">$wp_query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span> <span class="s1">&#39;wc-ajax&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$action</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">wc_ajax_headers</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$action</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$action</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;wc_ajax_&#39;</span> <span class="o">.</span> <span class="nv">$action</span> <span class="p">);</span><span class="c1">//关键代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">wp_die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// phpcs:enable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Process ajax checkout form.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">checkout</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">wc_maybe_define_constant</span><span class="p">(</span> <span class="s1">&#39;WOOCOMMERCE_CHECKOUT&#39;</span><span class="p">,</span> <span class="k">true</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">process_checkout</span><span class="p">();</span><span class="c1">//关键代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">wp_die</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>woocommerce/includes/class-wc-checkout.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Process the checkout after the confirm order button is pressed.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @throws Exception When validation fails.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">process_checkout</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$nonce_value</span>    <span class="o">=</span> <span class="nx">wc_get_var</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;woocommerce-process-checkout-nonce&#39;</span><span class="p">],</span> <span class="nx">wc_get_var</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;_wpnonce&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">// phpcs:ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$expiry_message</span> <span class="o">=</span> <span class="nx">sprintf</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* translators: %s: shop cart url */</span>
</span></span><span class="line"><span class="cl">            <span class="nx">__</span><span class="p">(</span> <span class="s1">&#39;Sorry, your session has expired. &lt;a href=&#34;%s&#34; class=&#34;wc-backward&#34;&gt;Return to shop&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;woocommerce&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="nx">esc_url</span><span class="p">(</span> <span class="nx">wc_get_page_permalink</span><span class="p">(</span> <span class="s1">&#39;shop&#39;</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$nonce_value</span> <span class="p">)</span> <span class="o">||</span> <span class="o">!</span> <span class="nx">wp_verify_nonce</span><span class="p">(</span> <span class="nv">$nonce_value</span><span class="p">,</span> <span class="s1">&#39;woocommerce-process_checkout&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// If the cart is empty, the nonce check failed because of session expiry.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">is_empty</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nv">$expiry_message</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span> <span class="s1">&#39;refresh_totals&#39;</span><span class="p">,</span> <span class="k">true</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nx">__</span><span class="p">(</span> <span class="s1">&#39;We were unable to process your order, please try again.&#39;</span><span class="p">,</span> <span class="s1">&#39;woocommerce&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">wc_maybe_define_constant</span><span class="p">(</span> <span class="s1">&#39;WOOCOMMERCE_CHECKOUT&#39;</span><span class="p">,</span> <span class="k">true</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">wc_set_time_limit</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;woocommerce_before_checkout_process&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span><span class="o">-&gt;</span><span class="na">is_empty</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nv">$expiry_message</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;woocommerce_checkout_process&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$errors</span>      <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$posted_data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_posted_data</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Update session for customer and totals.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_session</span><span class="p">(</span> <span class="nv">$posted_data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Validate posted data and cart items before proceeding.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate_checkout</span><span class="p">(</span> <span class="nv">$posted_data</span><span class="p">,</span> <span class="nv">$errors</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">errors</span> <span class="k">as</span> <span class="nv">$code</span> <span class="o">=&gt;</span> <span class="nv">$messages</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">get_error_data</span><span class="p">(</span> <span class="nv">$code</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$messages</span> <span class="k">as</span> <span class="nv">$message</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">wc_add_notice</span><span class="p">(</span> <span class="nv">$message</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$posted_data</span><span class="p">[</span><span class="s1">&#39;woocommerce_checkout_update_totals&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">===</span> <span class="nx">wc_notice_count</span><span class="p">(</span> <span class="s1">&#39;error&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">process_customer</span><span class="p">(</span> <span class="nv">$posted_data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$order_id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create_order</span><span class="p">(</span> <span class="nv">$posted_data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$order</span>    <span class="o">=</span> <span class="nx">wc_get_order</span><span class="p">(</span> <span class="nv">$order_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$order_id</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nv">$order_id</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$order</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nx">__</span><span class="p">(</span> <span class="s1">&#39;Unable to create order.&#39;</span><span class="p">,</span> <span class="s1">&#39;woocommerce&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;woocommerce_checkout_order_processed&#39;</span><span class="p">,</span> <span class="nv">$order_id</span><span class="p">,</span> <span class="nv">$posted_data</span><span class="p">,</span> <span class="nv">$order</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * Note that woocommerce_cart_needs_payment is only used in
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * WC_Checkout::process_checkout() to keep backwards compatibility.
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * Use woocommerce_order_needs_payment instead.
</span></span></span><span class="line"><span class="cl"><span class="sd">				 *
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * Note that at this point you can&#39;t rely on the Cart Object anymore,
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * since it could be empty see:
</span></span></span><span class="line"><span class="cl"><span class="sd">				 * https://github.com/woocommerce/woocommerce/issues/24631
</span></span></span><span class="line"><span class="cl"><span class="sd">				 */</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;woocommerce_cart_needs_payment&#39;</span><span class="p">,</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">needs_payment</span><span class="p">(),</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cart</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">process_order_payment</span><span class="p">(</span> <span class="nv">$order_id</span><span class="p">,</span> <span class="nv">$posted_data</span><span class="p">[</span><span class="s1">&#39;payment_method&#39;</span><span class="p">]</span> <span class="p">);</span><span class="c1">//关键代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">process_order_without_payment</span><span class="p">(</span> <span class="nv">$order_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">Exception</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">wc_add_notice</span><span class="p">(</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="s1">&#39;error&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">send_ajax_failure_response</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Process an order that does require payment.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @since 3.0.0
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param int    $order_id       Order ID.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $payment_method Payment method.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">process_order_payment</span><span class="p">(</span> <span class="nv">$order_id</span><span class="p">,</span> <span class="nv">$payment_method</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$available_gateways</span> <span class="o">=</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">payment_gateways</span><span class="o">-&gt;</span><span class="na">get_available_payment_gateways</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$available_gateways</span><span class="p">[</span> <span class="nv">$payment_method</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Store Order ID in session so it can be re-used after payment failure.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span> <span class="s1">&#39;order_awaiting_payment&#39;</span><span class="p">,</span> <span class="nv">$order_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// We save the session early because if the payment gateway hangs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// the request will never finish, thus the session data will neved be saved,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// and this can lead to duplicate orders if the user submits the order again.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">save_data</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Process Payment.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$available_gateways</span><span class="p">[</span> <span class="nv">$payment_method</span> <span class="p">]</span><span class="o">-&gt;</span><span class="na">process_payment</span><span class="p">(</span> <span class="nv">$order_id</span> <span class="p">);</span><span class="c1">//关键代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Redirect to success/confirmation/payment page.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;success&#39;</span> <span class="o">===</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$order_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;woocommerce_payment_successful_result&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">,</span> <span class="nv">$order_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">wp_doing_ajax</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// phpcs:ignore WordPress.Security.SafeRedirect.wp_redirect_wp_redirect
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">wp_redirect</span><span class="p">(</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;redirect&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">wp_send_json</span><span class="p">(</span> <span class="nv">$result</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="判断woocommerce是否启用">判断woocommerce是否启用
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="s1">&#39;woocommerce/woocommerce.php&#39;</span><span class="p">,</span> <span class="nx">get_option</span><span class="p">(</span><span class="s1">&#39;active_plugins&#39;</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="告诉woocommerce新增的网关">告诉woocommerce新增的网关
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;woocommerce_payment_gateways&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$methods</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$methods</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;WC_Gateway_Alipay&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$methods</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="必须调用的方法">必须调用的方法
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//在新增的网关类中调用$this-&gt;init_form_fields()、$this-&gt;init_settings()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 实现init_form_fields方法
</span></span></span><span class="line"><span class="cl"><span class="c1">// 可以参考woocommerce/includes/gateways/paypal/settings-paypal.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">init_form_fields</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">form_fields</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//是否启用当前的支付网关
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;enabled&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;启用/禁用&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;checkbox&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;label&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;是否启用支付宝网关，勾选为启用&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//当前支付网关的名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;标题&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;在结算时看到的当前支付网关的名称&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;支付宝&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;desc_tip&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//当前支付网关的描述
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;titile&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;描述&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;desc_tip&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;在结算时看到的当前支付网关的描述&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;将使用支付宝付款&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//以上三个字段是必须定义的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//下面可以定义一些当前支付网关的字段，如：app_id, mch_id
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;app_id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;titile&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;app_id&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;desc_tip&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;支付宝APP ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mch_id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;titile&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;mch_id&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;desc_tip&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;支付宝商户ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="保存后台设置的数据">保存后台设置的数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//在新增的网关类中挂载以下钩子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;woocommerce_update_options_payment_gateways_&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;process_admin_options&#39;</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="异步回调">异步回调
</h3><ul>
<li>生成异步回调链接</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//异步通知地址。生成一个URL：域名/wc-api/WC_Gateway_Awxpay
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notify_url</span> <span class="o">=</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">api_request_url</span><span class="p">(</span><span class="s1">&#39;WC_Gateway_Awxpay&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//异步退款通知地址。生成一个URL：域名/wc-api/WC_Gateway_Awxpay_Refund
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">refund_notify_url</span> <span class="o">=</span> <span class="nx">WC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">api_request_url</span><span class="p">(</span><span class="s1">&#39;WC_Gateway_Awxpay_Refund&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>挂载关键钩子</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//支付异步回调通知
</span></span></span><span class="line"><span class="cl"><span class="c1">//在plugins/woocommerce/includes/class-wc-api.php中的handle_api_requests()方法，处理了异步回调的请求，并且触发了对应的钩子。do_action( &#39;woocommerce_api_request&#39;, $api_request )和do_action( &#39;woocommerce_api_&#39; . $api_request );;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;woocommerce_api_wc_gateway_awxpay&#39;</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span><span class="s1">&#39;check_response&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//退款异步回调通知
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;woocommerce_api_wc_gateway_awxpay_refund&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;refund_response&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//订单完成时触发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_action</span><span class="p">(</span><span class="s2">&#34;woocommerce_order_status_completed&#34;</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;refund_order_trial_product&#39;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/wordpress/">Wordpress</a>
        
            <a href="/tags/-woocommerce/"> Woocommerce</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/wordpress%E4%B8%BB%E9%A2%98%E8%BF%9B%E9%98%B6/">
        
        

        <div class="article-details">
            <h2 class="article-title">Wordpress主题进阶</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/wordpress%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86/">
        
        

        <div class="article-details">
            <h2 class="article-title">Wordpress插件开发知识</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/wordpress%E4%B8%BB%E9%A2%98%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/">
        
        

        <div class="article-details">
            <h2 class="article-title">Wordpress主题核心知识点梳理</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="hollisho/hollisho-blog-talks"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 Hollis Ho
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
